<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙˆØ±ÙˆØ¯ Ùˆ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0;
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      direction: rtl;
    }
    .card {
      background:white;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.15);
      padding:30px;
      width:360px;
      max-width:90%;
      text-align:center;
      transition: all 0.5s ease;
    }
    input {
      width:100%;
      padding:12px;
      margin:10px 0;
      border:1px solid #ddd;
      border-radius:10px;
      font-size:15px;
      transition: all 0.3s ease;
    }
    input:focus {
      border-color:#0088cc;
      outline:none;
      box-shadow:0 0 5px rgba(0,136,204,0.4);
    }
    button {
      width:100%;
      padding:12px;
      margin-top:15px;
      border:none;
      border-radius:10px;
      background:#0088cc;
      color:white;
      font-size:16px;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background:#006fa1;
    }
    .hidden {
      display:none;
    }
    .success-msg {
      color:green;
      font-weight:bold;
      margin-bottom:10px;
    }
    .error-msg {
      color:red;
      font-weight:bold;
      margin-bottom:10px;
    }
    .profile {
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      margin-bottom:15px;
    }
    .profile img {
      width:50px;
      height:50px;
      border-radius:50%;
    }
    .fields input {
      margin-bottom:10px;
    }
  </style>
</head>
<body>
  <!-- Ú©Ø§Ø±Øª ÙˆØ±ÙˆØ¯ -->
  <div id="loginCard" class="card">
    <h2>ÙˆØ±ÙˆØ¯</h2>
    <input id="email" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„" />
    <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
    <button onclick="sendLogin()">ÙˆØ±ÙˆØ¯</button>
    <div id="loginResult"></div>
  </div>

  <!-- Ú©Ø§Ø±Øª Ù…ÙˆÙÙ‚ÛŒØª Ùˆ ÙØ±Ù… ØªÚ©Ù…ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª -->
  <div id="profileCard" class="card hidden">
    <div class="profile">
      <img id="userPhoto" src="" alt="Profile"/>
      <div id="welcomeMsg">Ø³Ù„Ø§Ù… Ú©Ø§Ø±Ø¨Ø±!</div>
    </div>
    <div class="fields">
      <input id="field1" placeholder="ÙÛŒÙ„Ø¯ 1"/>
      <input id="field2" placeholder="ÙÛŒÙ„Ø¯ 2"/>
      <input id="field3" placeholder="ÙÛŒÙ„Ø¯ 3"/>
    </div>
    <button onclick="sendProfile()">Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
    <div id="profileResult"></div>
  </div>

  <script>
    const loginCard = document.getElementById('loginCard');
    const profileCard = document.getElementById('profileCard');
    const loginResult = document.getElementById('loginResult');
    const profileResult = document.getElementById('profileResult');
    const welcomeMsg = document.getElementById('welcomeMsg');
    const userPhoto = document.getElementById('userPhoto');

    async function sendLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if(!email || !password){
        loginResult.innerHTML = '<div class="error-msg">âš ï¸ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div>';
        return;
      }

      loginResult.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';

      try {
        const res = await fetch('https://30530-0p8me.s2.irann8n.com/webhook/login-form', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({email,password})
        });
        const data = await res.json();
        console.log('Login response:', data);

        const user = data?.[0]?.data?.user || data?.[0];
        if(user?.verified){
          // Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„
          loginCard.classList.add('hidden');
          profileCard.classList.remove('hidden');
          welcomeMsg.innerText = `Ø³Ù„Ø§Ù… ${user.firstName || 'Ú©Ø§Ø±Ø¨Ø±'}!`;
          if(user.photo_url) userPhoto.src = user.photo_url;

          loginResult.innerHTML = '';
        } else {
          loginResult.innerHTML = '<div class="error-msg">âŒ ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</div>';
        }
      } catch(err){
        console.error(err);
        loginResult.innerHTML = `<div class="error-msg">ğŸš¨ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±</div>`;
      }
    }

    async function sendProfile(){
      const f1 = document.getElementById('field1').value.trim();
      const f2 = document.getElementById('field2').value.trim();
      const f3 = document.getElementById('field3').value.trim();

      if(!f1 || !f2 || !f3){
        profileResult.innerHTML = '<div class="error-msg">âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯</div>';
        return;
      }

      profileResult.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...';

      try {
        const res = await fetch('https://30530-0p8me.s2.irann8n.com/webhook-test/profile', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({field1:f1, field2:f2, field3:f3})
        });
        const result = await res.json();
        console.log('Profile response:', result);

        profileResult.innerHTML = '<div class="success-msg">âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!</div>';
      } catch(err){
        console.error(err);
        profileResult.innerHTML = `<div class="error-msg">ğŸš¨ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</div>`;
      }
    }
  </script>
</body>
</html>
