<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ورود و پروفایل</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0;
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      direction: rtl;
    }
    .card {
      background:white;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.15);
      padding:30px;
      width:360px;
      max-width:90%;
      text-align:center;
      transition: all 0.5s ease;
    }
    input {
      width:100%;
      padding:12px;
      margin:10px 0;
      border:1px solid #ddd;
      border-radius:10px;
      font-size:15px;
      transition: all 0.3s ease;
    }
    input:focus {
      border-color:#0088cc;
      outline:none;
      box-shadow:0 0 5px rgba(0,136,204,0.4);
    }
    button {
      width:100%;
      padding:12px;
      margin-top:15px;
      border:none;
      border-radius:10px;
      background:#0088cc;
      color:white;
      font-size:16px;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background:#006fa1;
    }
    .hidden {
      display:none;
    }
    .success-msg {
      color:green;
      font-weight:bold;
      margin-bottom:10px;
    }
    .error-msg {
      color:red;
      font-weight:bold;
      margin-bottom:10px;
    }
    .profile {
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      margin-bottom:15px;
    }
    .profile img {
      width:50px;
      height:50px;
      border-radius:50%;
    }
    .fields input {
      margin-bottom:10px;
    }
  </style>
</head>
<body>
  <!-- کارت ورود -->
  <div id="loginCard" class="card">
    <h2>ورود</h2>
    <input id="email" type="email" placeholder="ایمیل" />
    <input id="password" type="password" placeholder="رمز عبور" />
    <button onclick="sendLogin()">ورود</button>
    <div id="loginResult"></div>
  </div>

  <!-- کارت موفقیت و فرم تکمیل اطلاعات -->
  <div id="profileCard" class="card hidden">
    <div class="profile">
      <img id="userPhoto" src="" alt="Profile"/>
      <div id="welcomeMsg">سلام کاربر!</div>
    </div>
    <div class="fields">
      <input id="field1" placeholder="فیلد 1"/>
      <input id="field2" placeholder="فیلد 2"/>
      <input id="field3" placeholder="فیلد 3"/>
    </div>
    <button onclick="sendProfile()">ثبت اطلاعات</button>
    <div id="profileResult"></div>
  </div>

  <script>
    const loginCard = document.getElementById('loginCard');
    const profileCard = document.getElementById('profileCard');
    const loginResult = document.getElementById('loginResult');
    const profileResult = document.getElementById('profileResult');
    const welcomeMsg = document.getElementById('welcomeMsg');
    const userPhoto = document.getElementById('userPhoto');

    async function sendLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if(!email || !password){
        loginResult.innerHTML = '<div class="error-msg">⚠️ ایمیل و رمز را وارد کنید</div>';
        return;
      }

      loginResult.innerHTML = '⏳ در حال ارسال...';

      try {
        const res = await fetch('https://30530-0p8me.s2.irann8n.com/webhook/login-form', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({email,password})
        });
        const data = await res.json();
        console.log('Login response:', data);

        const user = data?.[0]?.data?.user || data?.[0];
        if(user?.verified){
          // نمایش کارت پروفایل
          loginCard.classList.add('hidden');
          profileCard.classList.remove('hidden');
          welcomeMsg.innerText = `سلام ${user.firstName || 'کاربر'}!`;
          if(user.photo_url) userPhoto.src = user.photo_url;

          loginResult.innerHTML = '';
        } else {
          loginResult.innerHTML = '<div class="error-msg">❌ ورود ناموفق بود</div>';
        }
      } catch(err){
        console.error(err);
        loginResult.innerHTML = `<div class="error-msg">🚨 خطا در اتصال به سرور</div>`;
      }
    }

    async function sendProfile(){
      const f1 = document.getElementById('field1').value.trim();
      const f2 = document.getElementById('field2').value.trim();
      const f3 = document.getElementById('field3').value.trim();

      if(!f1 || !f2 || !f3){
        profileResult.innerHTML = '<div class="error-msg">⚠️ لطفاً همه فیلدها را پر کنید</div>';
        return;
      }

      profileResult.innerHTML = '⏳ در حال ارسال اطلاعات...';

      try {
        const res = await fetch('https://30530-0p8me.s2.irann8n.com/webhook-test/profile', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({field1:f1, field2:f2, field3:f3})
        });
        const result = await res.json();
        console.log('Profile response:', result);

        profileResult.innerHTML = '<div class="success-msg">✅ اطلاعات با موفقیت ارسال شد!</div>';
      } catch(err){
        console.error(err);
        profileResult.innerHTML = `<div class="error-msg">🚨 خطا در ارسال اطلاعات</div>`;
      }
    }
  </script>
</body>
</html>
